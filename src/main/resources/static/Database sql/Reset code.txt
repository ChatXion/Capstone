-- Reset sequences using the ACTUAL sequence names from your database
-- Run this script to fix the duplicate key error

-- Reset organizations sequence
SELECT setval('organization_id_seq', (SELECT COALESCE(MAX(id), 1) FROM organizations));

-- Reset roles sequence
SELECT setval('role_id_seq', (SELECT COALESCE(MAX(id), 1) FROM roles));

-- Reset paycodes sequence
SELECT setval('paycode_id_seq', (SELECT COALESCE(MAX(id), 1) FROM paycodes));

-- Reset admins sequence (uses user_id_seq)
SELECT setval('user_id_seq', (SELECT GREATEST(
    COALESCE((SELECT MAX(id) FROM admins), 0),
    COALESCE((SELECT MAX(id) FROM employees), 0)
)));

-- Reset employees sequence (also uses user_id_seq, already set above)
-- No separate command needed since admins and employees share user_id_seq

-- Reset timesheets sequence
SELECT setval('timesheet_id_seq', (SELECT COALESCE(MAX(id), 1) FROM timesheets));

-- Reset timesheet_entries sequence
SELECT setval('timesheet_entry_id_seq', (SELECT COALESCE(MAX(id), 1) FROM timesheet_entries));

-- Reset pto_requests sequence
SELECT setval('pto_request_id_seq', (SELECT COALESCE(MAX(id), 1) FROM pto_requests));

-- Verify the sequences are set correctly
SELECT 'Sequences have been reset!' as status;

SELECT 'organization_id_seq' as sequence_name, last_value FROM organization_id_seq
UNION ALL
SELECT 'role_id_seq', last_value FROM role_id_seq
UNION ALL
SELECT 'paycode_id_seq', last_value FROM paycode_id_seq
UNION ALL
SELECT 'user_id_seq', last_value FROM user_id_seq
UNION ALL
SELECT 'timesheet_id_seq', last_value FROM timesheet_id_seq
UNION ALL
SELECT 'timesheet_entry_id_seq', last_value FROM timesheet_entry_id_seq
UNION ALL
SELECT 'pto_request_id_seq', last_value FROM pto_request_id_seq
ORDER BY sequence_name;